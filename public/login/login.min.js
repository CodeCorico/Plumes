!function(){"use strict";window.Ractive.controller("login",function(e,s,o,t,r){function n(){var e=l.message.outerHeight(!0);m.set("height",l.window.height()-(100+e+30)),m.set("helpTop",l.forgotTexts.position().top)}function a(){l.login.find(".name").focus()}function i(e,o,t,r,n){m.set("inModal",!0),m.set("message",e),m.set("messageType",o),m.set("storyboardMessage","sb-message-1"),setTimeout(function(){t&&m.set("username",""),r&&m.set("userpassword",""),"success"==o&&(m.set("usernamePlaceholder",s.texts.username),m.set("userpasswordPlaceholder",s.texts.userpassword)),m.set("storyboardMessage","sb-message-2"),setTimeout(function(){m.set("storyboardMessage","sb-message-3"),setTimeout(function(){m.set("storyboardMessage","sb-message-4"),setTimeout(function(){m.set("storyboardError",null),m.set("inModal",!1),n&&n()},350)},250)},3e3)},250)}function d(e,s,o,t){i(e,"error",s,o,t)}function u(e,s){i(e,"success",!0,!0,s)}function g(){m.get("inForgotPassword")?m.fire("forgotPassword",{password:m.get("username"),confirmPassword:m.get("userpassword")}):m.get("inForgotCode")?m.fire("forgotCode",{code:m.get("username")}):m.get("inForgot")?m.fire("forgot",{username:m.get("username")}):m.fire("login",{username:m.get("username"),userpassword:m.get("userpassword")})}function f(){m.fire("closed"),m&&!m.shouldDestroy&&m.teardown()}function c(){if(m){var e=m.get("storyboard");("sb-show-2"==e||"sb-show-3"==e||"sb-show-4"==e)&&n()}}var l={window:$(window),login:null};s.useforgot="undefined"==typeof s.useforgot?!0:s.useforgot,s.useforgot="true"==s.useforgot?!0:s.useforgot,s.useforgot="false"==s.useforgot?!1:s.useforgot,s.texts={},$.each(s,function(e,o){"text-"==e.substr(0,5)&&(e=e.substr(5,e.length-5),s.texts[e]=o)}),s.avatar=s.avatar?s.avatar:"null",s.inForgot=!1,s.texts.username="undefined"==typeof s.texts.username?"Name":s.texts.username,s.usernamePlaceholder=s.texts.username,s.texts.code="undefined"==typeof s.texts.code?"Code":s.texts.code,s.texts.userpassword="undefined"==typeof s.texts.userpassword?"Password":s.texts.userpassword,s.userpasswordPlaceholder=s.texts.userpassword,s.texts.userpasswordconfirm="undefined"==typeof s.texts.userpasswordconfirm?"Confirm password":s.texts.userpasswordconfirm,s.texts.forgotlink="undefined"==typeof s.texts.forgotlink?"I forgot my password":s.texts.forgotlink,s.texts.login="undefined"==typeof s.texts.login?"Back to login":s.texts.login,s.texts.forgottext="undefined"==typeof s.texts.forgottext?'Submit your email and press <span class="key">ENTER</span> to receive a validation code in your mailbox.':s.texts.forgottext,s.texts.forgotcodetext="undefined"==typeof s.texts.forgotcodetext?'Use your <strong>validation code</strong> and press <span class="key">ENTER</span> to get the possibility to change your password.':s.texts.forgotcodetext,s.texts.forgotpasswordtext="undefined"==typeof s.texts.forgotpasswordtext?'Enter your new password twice (to confirm) and press <span class="key">ENTER</span> to change your password.':s.texts.forgotpasswordtext,s.texts.forgotpasswordhelp="undefined"==typeof s.texts.forgotpasswordhelp?"When creating your password, remember the following:<ol><li>It must not contain your name.</li><li>It must contain one or more digits.</li><li>It is recommended to mix lowercase and uppercase characters.</li><li>It should be long over 7 characters.</li></ol>":s.texts.forgotpasswordhelp;var m=e({data:$.extend(!0,{show:!1,top:0},s)});l.login=$(m.el),l.forgotTexts=l.login.find(".login-forgot-texts"),l.login.find(".login-form-content .input").keypress(function(e){13==e.which&&(g(),e.preventDefault(),e.stopPropagation())});var p=new Date;m.observe("username",function(){if(!m.get("inForgotCode")&&!m.get("inForgotPassword")){p=new Date;var e=m.get("username");setTimeout(function(){(new Date).getTime()-p.getTime()>=1e3&&m.fire("username",{username:e})},1e3)}}),m.observe("avatar",function(e,s){s!=e&&(e||(e="null",m.set("avatar",e),"null"!=s))&&(m.set("oldAvatar",s),setTimeout(function(){m.set("oldAvatar",null)},650))}),m.on("teardown",function(){m=null,l.window.off("resize",c)}),m.on("logged",function(e){var s=m.childrenRequire[0];s.fire("closeTitle"),m.set("storyboard","sb-hide-1"),m.set("top",0),m.set("height",l.window.height()),setTimeout(function(){m.set("storyboard","sb-hide-2"),setTimeout(function(){m.set("storyboard","sb-hide-3"),setTimeout(function(){e?s.fire("play",{message:e,done:function(){f()}}):f()},150)},400)},350)}),m.on("close",f),m.on("error",function(e){e=$.extend(!0,{message:"You have an error in your credentials.",clearUsername:!1,clearUserpassword:!0},e||{}),d(e.message,e.clearUsername,e.clearUserpassword,a)}),m.on("displayForgot",function(){n(),m.set("inForgot",!0),m.fire("enterForgot"),setTimeout(a)}),m.on("openHelp",function(){m.set("inHelp",!0),setTimeout(a)}),m.on("displayLogin",function(){var e=m.get("inForgot"),o=m.get("inForgotCode"),t=m.get("inForgotPassword");(o||t)&&(m.set("username",""),m.set("userpassword","")),m.set("inHelp",!1),m.set("inForgot",!1),m.set("inForgotCode",!1),m.set("inForgotPassword",!1),m.set("usernamePlaceholder",s.texts.username),m.set("userpasswordPlaceholder",s.texts.userpassword),o&&m.fire("exitForgotCode"),t&&m.fire("exitForgotPassword"),e&&m.fire("exitForgot"),setTimeout(a)}),m.on("forgotSuccess",function(){m.set("inForgotCode",!0),m.set("username",""),m.set("usernamePlaceholder",s.texts.code),m.fire("enterForgotCode"),setTimeout(a)}),m.on("forgotError",function(e){e=$.extend(!0,{message:"This email address doesn't exist.",clearUsername:!1,clearUserpassword:!1},e||{}),d(e.message,e.clearUsername,e.clearUserpassword,a)}),m.on("forgotCodeSuccess",function(){m.set("inForgotCode",!1),m.set("inForgotPassword",!0),m.set("username",""),m.set("usernamePlaceholder",s.texts.userpassword),m.set("userpassword",""),m.set("userpasswordPlaceholder",s.texts.userpasswordconfirm),m.fire("enterForgotPassword"),setTimeout(a)}),m.on("forgotCodeError",function(e){e=$.extend(!0,{message:"Code invalid.",clearUsername:!0,clearUserpassword:!1},e||{}),d(e.message,e.clearUsername,e.clearUserpassword,a)}),m.on("forgotPasswordSuccess",function(e){e=$.extend(!0,{message:"New password registered."},e||{}),u(e.message,function(){m.fire("displayLogin")})}),m.on("forgotPasswordError",function(e){e=$.extend(!0,{message:"Passwords are invalid.",clearUsername:!0,clearUserpassword:!0},e||{}),d(e.message,e.clearUsername,e.clearUserpassword,a)}),l.window.resize(c),m.require().then(function(){var e=m.childrenRequire[0],o=m.get("texts.question");o=o||""===o?o:"Who are you?",e.fire("play",{message:o,lastLineToTitle:!0,displayTextTime:350,done:function(){l.message=$(e.el).find(".screen-message-message");var o=l.message.outerHeight(!0);m.set("top",l.message.offset().top+o-1),m.set("height",1),m.set("storyboard","sb-show-1"),setTimeout(function(){m.set("storyboard","sb-show-2"),m.set("top",100+o),n(),setTimeout(function(){m.set("storyboard","sb-show-3"),setTimeout(function(){l.login.find(s.username?".password":".name").focus(),m.set("storyboard","sb-show-4")},450)},450)},650)}}),r()})})}();
//# sourceMappingURL=../login/login.min.js.map