{"version":3,"sources":["login/login.js"],"names":["window","Ractive","controller","component","data","el","config","done","_refresh","messageHeight","_$el","message","outerHeight","Login","set","height","_close","fire","teardown","$","texts","each","name","value","substr","length","avatar","username","userpassword","extend","show","top","on","get","observe","oldValue","setTimeout","text","ScreenMessage","childrenRequire","event","original","preventDefault","args","clearUsername","clearUserpassword","resize","storyboard","require","then","textQuestion","lastLineToTitle","displayTextTime","find","offset","focus"],"mappings":"CAAA,WACE,YAEAA,QAAOC,QAAQC,WAAW,QAAS,SAASC,EAAWC,EAAMC,EAAIC,EAAQC,GAmBvE,QAASC,KACP,GAAIC,GAAgBC,EAAKC,QAAQC,aAAY,EAE7CC,GAAMC,IAAI,SAAUJ,EAAKV,OAAOe,UAAY,IAAMN,EAAgB,KAgCpE,QAASO,KACPH,EAAMI,KAAK,UACXJ,EAAMK,WAtDR,GAAIR,IACEV,OAAQmB,EAAEnB,QAGhBI,GAAKgB,SAELD,EAAEE,KAAKjB,EAAM,SAASkB,EAAMC,GACD,SAArBD,EAAKE,OAAO,EAAG,KACjBF,EAAOA,EAAKE,OAAO,EAAGF,EAAKG,OAAS,GACpCrB,EAAKgB,MAAME,GAAQC,KAIvBnB,EAAKsB,OAAUtB,EAAKsB,OAAkBtB,EAAKsB,OAAd,OAC7BtB,EAAKgB,MAAMO,SAAyC,mBAAvBvB,GAAKgB,MAAMO,SAA0B,OAASvB,EAAKgB,MAAMO,SACtFvB,EAAKgB,MAAMQ,aAAiD,mBAA3BxB,GAAKgB,MAAMQ,aAA8B,WAAaxB,EAAKgB,MAAMQ,YAQlG,IAAIf,GAAQV,GACVC,KAAMe,EAAEU,QAAO,GACbC,MAAM,EACNC,IAAK,GACJ3B,IAGLS,GAAMmB,GAAG,gBAAiB,WACxBnB,EAAMI,KAAK,kBAAmBJ,EAAMoB,IAAI,eAG1CpB,EAAMqB,QAAQ,SAAU,SAASX,EAAOY,GAClCA,GAAYZ,IAGXA,IACHA,EAAQ,OACRV,EAAMC,IAAI,SAAUS,GACJ,QAAZY,MAKNtB,EAAMC,IAAI,YAAaqB,GACvBC,WAAW,WACTvB,EAAMC,IAAI,YAAa,OACtB,QAQLD,EAAMmB,GAAG,SAAU,SAASK,GAC1B,GAAIC,GAAgBzB,EAAM0B,gBAAgB,EAC1CD,GAAcrB,KAAK,cAEnBJ,EAAMC,IAAI,aAAc,aAExBD,EAAMC,IAAI,MAAO,GACjBD,EAAMC,IAAI,SAAUJ,EAAKV,OAAOe,UAEhCqB,WAAW,WACTvB,EAAMC,IAAI,aAAc,aAExBsB,WAAW,WACTvB,EAAMC,IAAI,aAAc,aAExBsB,WAAW,WAELC,EACFC,EAAcrB,KAAK,QACjBN,QAAS0B,EACT9B,KAAM,WACJS,OAKJA,KAED,MACF,MACF,OAGLH,EAAMmB,GAAG,QAAS,WAChBnB,EAAMI,KAAK,UACXJ,EAAMK,aAGRL,EAAMmB,GAAG,SAAU,SAASQ,GAC1B3B,EAAMI,KAAK,SACTU,SAAUd,EAAMoB,IAAI,YACpBL,aAAcf,EAAMoB,IAAI,kBAG1BO,EAAMC,SAASC,mBAGjB7B,EAAMmB,GAAG,QAAS,SAASW,GACzBA,EAAOxB,EAAEU,QAAO,GACdlB,QAAS,yCACTiC,eAAe,EACfC,mBAAmB,GAClBF,OAEH9B,EAAMC,IAAI,QAAS6B,EAAKhC,SACxBE,EAAMC,IAAI,kBAAmB,cAE7BsB,WAAW,WACLO,EAAKC,eACP/B,EAAMC,IAAI,WAAY,IAEpB6B,EAAKE,mBACPhC,EAAMC,IAAI,eAAgB,IAG5BD,EAAMC,IAAI,kBAAmB,cAC7BsB,WAAW,WACTvB,EAAMC,IAAI,kBAAmB,cAC7BsB,WAAW,WACTvB,EAAMC,IAAI,kBAAmB,cAC7BsB,WAAW,WACTvB,EAAMC,IAAI,kBAAmB,OAC5B,MACF,MACF,MACF,OAGLJ,EAAKV,OAAO8C,OAAO,WACjB,GAAKjC,EAAL,CAIA,GAAIkC,GAAalC,EAAMoB,IAAI,eAET,aAAdc,GAA2C,aAAdA,IAC/BvC,OAIJK,EAAMmC,UAAUC,KAAK,WACnB,GAAIX,GAAgBzB,EAAM0B,gBAAgB,GACtCW,EAAerC,EAAMoB,IAAI,iBAE7BiB,GAAgBA,GAAiC,KAAjBA,EAAuCA,EAAjB,eAEtDZ,EAAcrB,KAAK,QACjBN,QAASuC,EACTC,iBAAiB,EACjBC,gBAAiB,IACjB7C,KAAM,WACJG,EAAKC,QAAUQ,EAAEmB,EAAcjC,IAAIgD,KAAK,0BAExC,IAAI5C,GAAgBC,EAAKC,QAAQC,aAAY,EAE7CC,GAAMC,IAAI,MAAOJ,EAAKC,QAAQ2C,SAASvB,IAAMtB,EAAgB,GAC7DI,EAAMC,IAAI,SAAU,GACpBD,EAAMC,IAAI,aAAc,aAExBsB,WAAW,WACTvB,EAAMC,IAAI,aAAc,aACxBD,EAAMC,IAAI,MAAO,IAAML,GACvBD,IAEA4B,WAAW,WACTvB,EAAMC,IAAI,aAAc,aAExBsB,WAAW,WACTjB,EAAEN,EAAMR,IAAIgD,KAAMjD,EAAKuB,SAAqB,YAAV,SAAuB4B,SACxD,MAEF,MACF,QAIPhD","file":"login/login.min.js","sourcesContent":["(function() {\n  'use strict';\n\n  window.Ractive.controller('login', function(component, data, el, config, done) {\n\n    var _$el = {\n          window: $(window)\n        };\n\n    data.texts = {};\n\n    $.each(data, function(name, value) {\n      if (name.substr(0, 5) == 'text-') {\n        name = name.substr(5, name.length - 5);\n        data.texts[name] = value;\n      }\n    });\n\n    data.avatar = !data.avatar ? 'null' : data.avatar;\n    data.texts.username = typeof data.texts.username == 'undefined' ? 'Name' : data.texts.username;\n    data.texts.userpassword = typeof data.texts.userpassword == 'undefined' ? 'Password' : data.texts.userpassword;\n\n    function _refresh() {\n      var messageHeight = _$el.message.outerHeight(true);\n\n      Login.set('height', _$el.window.height() - (100 + messageHeight + 30));\n    }\n\n    var Login = component({\n      data: $.extend(true, {\n        show: false,\n        top: 0\n      }, data)\n    });\n\n    Login.on('passwordFocus', function() {\n      Login.fire('usernameChanged', Login.get('username'));\n    });\n\n    Login.observe('avatar', function(value, oldValue) {\n      if (oldValue == value) {\n        return;\n      }\n      if (!value) {\n        value = 'null';\n        Login.set('avatar', value);\n        if (oldValue == 'null') {\n          return;\n        }\n      }\n\n      Login.set('oldAvatar', oldValue);\n      setTimeout(function() {\n        Login.set('oldAvatar', null);\n      }, 650);\n    });\n\n    function _close() {\n      Login.fire('closed');\n      Login.teardown();\n    }\n\n    Login.on('logged', function(text) {\n      var ScreenMessage = Login.childrenRequire[0];\n      ScreenMessage.fire('closeTitle');\n\n      Login.set('storyboard', 'sb-hide-1');\n\n      Login.set('top', 0);\n      Login.set('height', _$el.window.height());\n\n      setTimeout(function() {\n        Login.set('storyboard', 'sb-hide-2');\n\n        setTimeout(function() {\n          Login.set('storyboard', 'sb-hide-3');\n\n          setTimeout(function() {\n\n            if (text) {\n              ScreenMessage.fire('play', {\n                message: text,\n                done: function() {\n                  _close();\n                }\n              });\n            }\n            else {\n              _close();\n            }\n          }, 150);\n        }, 400);\n      }, 350);\n    });\n\n    Login.on('close', function() {\n      Login.fire('closed');\n      Login.teardown();\n    });\n\n    Login.on('submit', function(event) {\n      Login.fire('login', {\n        username: Login.get('username'),\n        userpassword: Login.get('userpassword')\n      });\n\n      event.original.preventDefault();\n    });\n\n    Login.on('error', function(args) {\n      args = $.extend(true, {\n        message: 'You have an error in your credentials.',\n        clearUsername: false,\n        clearUserpassword: true\n      }, args || {});\n\n      Login.set('error', args.message);\n      Login.set('storyboardError', 'sb-error-1');\n\n      setTimeout(function() {\n        if (args.clearUsername) {\n          Login.set('username', '');\n        }\n        if (args.clearUserpassword) {\n          Login.set('userpassword', '');\n        }\n\n        Login.set('storyboardError', 'sb-error-2');\n        setTimeout(function() {\n          Login.set('storyboardError', 'sb-error-3');\n          setTimeout(function() {\n            Login.set('storyboardError', 'sb-error-4');\n            setTimeout(function() {\n              Login.set('storyboardError', null);\n            }, 350);\n          }, 250);\n        }, 3000);\n      }, 250);\n    });\n\n    _$el.window.resize(function() {\n      if (!Login) {\n        return;\n      }\n\n      var storyboard = Login.get('storyboard');\n\n      if (storyboard == 'sb-show-2' || storyboard == 'sb-show-3') {\n        _refresh();\n      }\n    });\n\n    Login.require().then(function() {\n      var ScreenMessage = Login.childrenRequire[0],\n          textQuestion = Login.get('texts.question');\n\n      textQuestion = !textQuestion && textQuestion !== '' ? 'Who are you?' : textQuestion;\n\n      ScreenMessage.fire('play', {\n        message: textQuestion,\n        lastLineToTitle: true,\n        displayTextTime: 350,\n        done: function() {\n          _$el.message = $(ScreenMessage.el).find('.screen-message-message');\n\n          var messageHeight = _$el.message.outerHeight(true);\n\n          Login.set('top', _$el.message.offset().top + messageHeight - 1);\n          Login.set('height', 1);\n          Login.set('storyboard', 'sb-show-1');\n\n          setTimeout(function() {\n            Login.set('storyboard', 'sb-show-2');\n            Login.set('top', 100 + messageHeight);\n            _refresh();\n\n            setTimeout(function() {\n              Login.set('storyboard', 'sb-show-3');\n\n              setTimeout(function() {\n                $(Login.el).find(!data.username ? '.name' : '.password').focus();\n              }, 450);\n\n            }, 450);\n          }, 650);\n        }\n      });\n\n      done();\n    });\n\n  });\n\n})();\n"],"sourceRoot":"/source/"}