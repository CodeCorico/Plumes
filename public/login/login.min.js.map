{"version":3,"sources":["login/login.js"],"names":["window","Ractive","controller","component","data","el","config","done","_refresh","messageHeight","_$el","message","outerHeight","Login","set","height","_close","fire","teardown","$","texts","each","name","value","substr","length","avatar","username","userpassword","extend","show","top","on","get","observe","oldValue","setTimeout","text","ScreenMessage","childrenRequire","event","original","preventDefault","args","clearUsername","clearUserpassword","resize","storyboard","require","then","textQuestion","lastLineToTitle","displayTextTime","find","offset","focus"],"mappings":"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","file":"login/login.min.js","sourcesContent":["(function() {\r\n  'use strict';\r\n\r\n  window.Ractive.controller('login', function(component, data, el, config, done) {\r\n\r\n    var _$el = {\r\n          window: $(window)\r\n        };\r\n\r\n    data.texts = {};\r\n\r\n    $.each(data, function(name, value) {\r\n      if (name.substr(0, 5) == 'text-') {\r\n        name = name.substr(5, name.length - 5);\r\n        data.texts[name] = value;\r\n      }\r\n    });\r\n\r\n    data.avatar = typeof data.avatar == 'undefined' ? '/public/login/avatar.png' : data.avatar;\r\n    data.texts.username = typeof data.texts.username == 'undefined' ? 'Name' : data.texts.username;\r\n    data.texts.userpassword = typeof data.texts.userpassword == 'undefined' ? 'Password' : data.texts.userpassword;\r\n\r\n    function _refresh() {\r\n      var messageHeight = _$el.message.outerHeight(true);\r\n\r\n      Login.set('height', _$el.window.height() - (100 + messageHeight + 30));\r\n    }\r\n\r\n    var Login = component({\r\n      data: $.extend(true, {\r\n        show: false,\r\n        top: 0\r\n      }, data)\r\n    });\r\n\r\n    Login.on('passwordFocus', function() {\r\n      Login.fire('usernameChanged', Login.get('username'));\r\n    });\r\n\r\n    Login.observe('avatar', function(value, oldValue) {\r\n      if (oldValue == value) {\r\n        return;\r\n      }\r\n\r\n      Login.set('oldAvatar', oldValue);\r\n      setTimeout(function() {\r\n        Login.set('oldAvatar', null);\r\n      }, 650);\r\n    });\r\n\r\n    function _close() {\r\n      Login.fire('closed');\r\n      Login.teardown();\r\n    }\r\n\r\n    Login.on('logged', function(text) {\r\n      var ScreenMessage = Login.childrenRequire[0];\r\n      ScreenMessage.fire('closeTitle');\r\n\r\n      Login.set('storyboard', 'sb-hide-1');\r\n\r\n      Login.set('top', 0);\r\n      Login.set('height', _$el.window.height());\r\n\r\n      setTimeout(function() {\r\n        Login.set('storyboard', 'sb-hide-2');\r\n\r\n        setTimeout(function() {\r\n          Login.set('storyboard', 'sb-hide-3');\r\n\r\n          setTimeout(function() {\r\n\r\n            if (text) {\r\n              ScreenMessage.fire('play', {\r\n                message: text,\r\n                done: function() {\r\n                  _close();\r\n                }\r\n              });\r\n            }\r\n            else {\r\n              _close();\r\n            }\r\n          }, 150);\r\n        }, 400);\r\n      }, 350);\r\n    });\r\n\r\n    Login.on('close', function() {\r\n      Login.fire('closed');\r\n      Login.teardown();\r\n    });\r\n\r\n    Login.on('submit', function(event) {\r\n      Login.fire('login', {\r\n        username: Login.get('username'),\r\n        userpassword: Login.get('userpassword')\r\n      });\r\n\r\n      event.original.preventDefault();\r\n    });\r\n\r\n    Login.on('error', function(args) {\r\n      args = $.extend(true, {\r\n        message: 'You have an error in your credentials.',\r\n        clearUsername: false,\r\n        clearUserpassword: true\r\n      }, args || {});\r\n\r\n      Login.set('error', args.message);\r\n      Login.set('storyboardError', 'sb-error-1');\r\n\r\n      setTimeout(function() {\r\n        if (args.clearUsername) {\r\n          Login.set('username', '');\r\n        }\r\n        if (args.clearUserpassword) {\r\n          Login.set('userpassword', '');\r\n        }\r\n\r\n        Login.set('storyboardError', 'sb-error-2');\r\n        setTimeout(function() {\r\n          Login.set('storyboardError', 'sb-error-3');\r\n          setTimeout(function() {\r\n            Login.set('storyboardError', 'sb-error-4');\r\n            setTimeout(function() {\r\n              Login.set('storyboardError', null);\r\n            }, 350);\r\n          }, 250);\r\n        }, 3000);\r\n      }, 250);\r\n    });\r\n\r\n    _$el.window.resize(function() {\r\n      if (!Login) {\r\n        return;\r\n      }\r\n\r\n      var storyboard = Login.get('storyboard');\r\n\r\n      if (storyboard == 'sb-show-2' || storyboard == 'sb-show-3') {\r\n        _refresh();\r\n      }\r\n    });\r\n\r\n    Login.require().then(function() {\r\n      var ScreenMessage = Login.childrenRequire[0],\r\n          textQuestion = Login.get('texts.question');\r\n\r\n      textQuestion = !textQuestion && textQuestion !== '' ? 'Who are you?' : textQuestion;\r\n\r\n      ScreenMessage.fire('play', {\r\n        message: textQuestion,\r\n        lastLineToTitle: true,\r\n        displayTextTime: 350,\r\n        done: function() {\r\n          _$el.message = $(ScreenMessage.el).find('.screen-message-message');\r\n\r\n          var messageHeight = _$el.message.outerHeight(true);\r\n\r\n          Login.set('top', _$el.message.offset().top + messageHeight - 1);\r\n          Login.set('height', 1);\r\n          Login.set('storyboard', 'sb-show-1');\r\n\r\n          setTimeout(function() {\r\n            Login.set('storyboard', 'sb-show-2');\r\n            Login.set('top', 100 + messageHeight);\r\n            _refresh();\r\n\r\n            setTimeout(function() {\r\n              Login.set('storyboard', 'sb-show-3');\r\n\r\n              setTimeout(function() {\r\n                $(Login.el).find(!data.username ? '.name' : '.password').focus();\r\n              }, 450);\r\n\r\n            }, 450);\r\n          }, 650);\r\n        }\r\n      });\r\n\r\n      done();\r\n    });\r\n\r\n  });\r\n\r\n})();\r\n"],"sourceRoot":"/source/"}