{"version":3,"sources":["login/login.js"],"names":["window","Ractive","controller","component","data","el","config","done","_refresh","messageHeight","_$el","message","outerHeight","Login","set","height","_close","fire","shouldDestroy","teardown","_resize","storyboard","get","$","texts","each","name","value","substr","length","avatar","username","userpassword","extend","show","top","on","observe","oldValue","setTimeout","off","text","ScreenMessage","childrenRequire","event","original","preventDefault","args","clearUsername","clearUserpassword","resize","require","then","textQuestion","lastLineToTitle","displayTextTime","find","offset","focus"],"mappings":"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","file":"login/login.min.js","sourcesContent":["(function() {\n  'use strict';\n\n  window.Ractive.controller('login', function(component, data, el, config, done) {\n\n    var _$el = {\n          window: $(window)\n        };\n\n    data.texts = {};\n\n    $.each(data, function(name, value) {\n      if (name.substr(0, 5) == 'text-') {\n        name = name.substr(5, name.length - 5);\n        data.texts[name] = value;\n      }\n    });\n\n    data.avatar = !data.avatar ? 'null' : data.avatar;\n    data.texts.username = typeof data.texts.username == 'undefined' ? 'Name' : data.texts.username;\n    data.texts.userpassword = typeof data.texts.userpassword == 'undefined' ? 'Password' : data.texts.userpassword;\n\n    function _refresh() {\n      var messageHeight = _$el.message.outerHeight(true);\n\n      Login.set('height', _$el.window.height() - (100 + messageHeight + 30));\n    }\n\n    var Login = component({\n      data: $.extend(true, {\n        show: false,\n        top: 0\n      }, data)\n    });\n\n    Login.on('passwordFocus', function() {\n      Login.fire('usernameChanged', Login.get('username'));\n    });\n\n    Login.observe('avatar', function(value, oldValue) {\n      if (oldValue == value) {\n        return;\n      }\n      if (!value) {\n        value = 'null';\n        Login.set('avatar', value);\n        if (oldValue == 'null') {\n          return;\n        }\n      }\n\n      Login.set('oldAvatar', oldValue);\n      setTimeout(function() {\n        Login.set('oldAvatar', null);\n      }, 650);\n    });\n\n    Login.on('teardown', function() {\n      Login = null;\n      _$el.window.off('resize', _resize);\n    });\n\n    function _close() {\n      Login.fire('closed');\n\n      if (Login && !Login.shouldDestroy) {\n        Login.teardown();\n      }\n    }\n\n    Login.on('logged', function(text) {\n      var ScreenMessage = Login.childrenRequire[0];\n      ScreenMessage.fire('closeTitle');\n\n      Login.set('storyboard', 'sb-hide-1');\n\n      Login.set('top', 0);\n      Login.set('height', _$el.window.height());\n\n      setTimeout(function() {\n        Login.set('storyboard', 'sb-hide-2');\n\n        setTimeout(function() {\n          Login.set('storyboard', 'sb-hide-3');\n\n          setTimeout(function() {\n\n            if (text) {\n              ScreenMessage.fire('play', {\n                message: text,\n                done: function() {\n                  _close();\n                }\n              });\n            }\n            else {\n              _close();\n            }\n          }, 150);\n        }, 400);\n      }, 350);\n    });\n\n    Login.on('close', _close);\n\n    Login.on('submit', function(event) {\n      Login.fire('login', {\n        username: Login.get('username'),\n        userpassword: Login.get('userpassword')\n      });\n\n      event.original.preventDefault();\n    });\n\n    Login.on('error', function(args) {\n      args = $.extend(true, {\n        message: 'You have an error in your credentials.',\n        clearUsername: false,\n        clearUserpassword: true\n      }, args || {});\n\n      Login.set('error', args.message);\n      Login.set('storyboardError', 'sb-error-1');\n\n      setTimeout(function() {\n        if (args.clearUsername) {\n          Login.set('username', '');\n        }\n        if (args.clearUserpassword) {\n          Login.set('userpassword', '');\n        }\n\n        Login.set('storyboardError', 'sb-error-2');\n        setTimeout(function() {\n          Login.set('storyboardError', 'sb-error-3');\n          setTimeout(function() {\n            Login.set('storyboardError', 'sb-error-4');\n            setTimeout(function() {\n              Login.set('storyboardError', null);\n            }, 350);\n          }, 250);\n        }, 3000);\n      }, 250);\n    });\n\n    function _resize() {\n      if (!Login) {\n        return;\n      }\n\n      var storyboard = Login.get('storyboard');\n\n      if (storyboard == 'sb-show-2' || storyboard == 'sb-show-3') {\n        _refresh();\n      }\n    }\n\n    _$el.window.resize(_resize);\n\n    Login.require().then(function() {\n      var ScreenMessage = Login.childrenRequire[0],\n          textQuestion = Login.get('texts.question');\n\n      textQuestion = !textQuestion && textQuestion !== '' ? 'Who are you?' : textQuestion;\n\n      ScreenMessage.fire('play', {\n        message: textQuestion,\n        lastLineToTitle: true,\n        displayTextTime: 350,\n        done: function() {\n          _$el.message = $(ScreenMessage.el).find('.screen-message-message');\n\n          var messageHeight = _$el.message.outerHeight(true);\n\n          Login.set('top', _$el.message.offset().top + messageHeight - 1);\n          Login.set('height', 1);\n          Login.set('storyboard', 'sb-show-1');\n\n          setTimeout(function() {\n            Login.set('storyboard', 'sb-show-2');\n            Login.set('top', 100 + messageHeight);\n            _refresh();\n\n            setTimeout(function() {\n              Login.set('storyboard', 'sb-show-3');\n\n              setTimeout(function() {\n                $(Login.el).find(!data.username ? '.name' : '.password').focus();\n              }, 450);\n\n            }, 450);\n          }, 650);\n        }\n      });\n\n      done();\n    });\n\n  });\n\n})();\n"],"sourceRoot":"/source/"}