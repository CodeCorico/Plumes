{"version":3,"sources":["login/pl-login.js"],"names":["window","Ractive","controller","component","data","el","config","done","_refresh","messageHeight","_$el","message","outerHeight","Login","set","height","forgotTexts","length","forgototTexts","position","top","_focusName","login","find","focus","_modal","type","clearUsername","clearUserpassword","callback","setTimeout","get","_error","_success","_submit","fire","password","confirmPassword","code","username","userpassword","_close","shouldDestroy","teardown","_resize","storyboard","avatar","plName","$","extend","show","inForgot","texts","userpasswordconfirm","forgotlink","forgottext","forgotcodetext","forgotpasswordtext","forgotpasswordhelp","join","bindUses","bindTexts","observe","value","keypress","event","which","preventDefault","stopPropagation","lastObserveUsernameDate","Date","getTime","oldValue","on","off","text","ScreenMessage","findChild","args","inForgotCode","inForgotPassword","resize","require","then","textQuestion","lastLineToTitle","displayTextTime","offset"],"mappings":"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","file":"login/pl-login.min.js","sourcesContent":["(function() {\n  'use strict';\n\n  window.Ractive.controller('pl-login', function(component, data, el, config, done) {\n\n    data.avatar = !data.avatar ? 'null' : data.avatar;\n\n    var Login = component({\n          plName: 'pl-login',\n          data: $.extend(true, {\n            show: false,\n            top: 0,\n            inForgot: false,\n            texts: {\n              username: 'Name',\n              code: 'Code',\n              userpassword: 'Password',\n              userpasswordconfirm: 'Confirm password',\n              forgotlink: 'I forgot my password',\n              login: 'Back to login',\n              forgottext: 'Submit your email and press <span class=\"key\">ENTER</span> to receive a validation code in your mailbox.',\n              forgotcodetext: 'Use your <strong>validation code</strong> and press <span class=\"key\">ENTER</span> to get the possibility to change your password.',\n              forgotpasswordtext: 'Enter your new password twice (to confirm) and press <span class=\"key\">ENTER</span> to change your password.',\n              forgotpasswordhelp: [\n                'When creating your password, remember the following:',\n                '<ol>',\n                  '<li>It must not contain your name.</li>',\n                  '<li>It must contain one or more digits.</li>',\n                  '<li>It is recommended to mix lowercase and uppercase characters.</li>',\n                  '<li>It should be long over 7 characters.</li>',\n                '</ol>'\n              ].join('')\n            }\n          }, data)\n        }),\n        _$el = {\n          window: $(window),\n          login: $(Login.el),\n          forgotTexts: $(Login.el).find('.pl-login-forgot-texts')\n        };\n\n    window.Ractive.bindUses(Login, ['forgot']);\n\n    window.Ractive.bindTexts(Login);\n\n    Login.observe('texts.username', function(value) {\n      Login.set('texts.usernamePlaceholder', value);\n    });\n\n    Login.observe('texts.userpassword', function(value) {\n      Login.set('texts.userpasswordPlaceholder', value);\n    });\n\n    function _refresh() {\n      var messageHeight = _$el.message.outerHeight(true);\n\n      Login.set('height', _$el.window.height() - (40 + messageHeight + 30));\n\n      if (_$el.forgotTexts.length) {\n        Login.set('helpTop', _$el.forgototTexts.position().top);\n      }\n    }\n\n    function _focusName() {\n      _$el.login.find('.name').focus();\n    }\n\n    function _modal(message, type, clearUsername, clearUserpassword, callback) {\n      Login.set('inModal', true);\n      Login.set('message', message);\n      Login.set('messageType', type);\n      Login.set('storyboardMessage', 'sb-message-1');\n\n      setTimeout(function() {\n        if (clearUsername) {\n          Login.set('username', '');\n        }\n        if (clearUserpassword) {\n          Login.set('userpassword', '');\n        }\n\n        if (type == 'success') {\n          Login.set('texts.usernamePlaceholder', Login.get('texts.username'));\n          Login.set('texts.userpasswordPlaceholder', Login.get('texts.userpassword'));\n        }\n\n        Login.set('storyboardMessage', 'sb-message-2');\n        setTimeout(function() {\n          Login.set('storyboardMessage', 'sb-message-3');\n          setTimeout(function() {\n            Login.set('storyboardMessage', 'sb-message-4');\n            setTimeout(function() {\n              Login.set('storyboardError', null);\n              Login.set('inModal', false);\n\n              if (callback) {\n                callback();\n              }\n            }, 350);\n          }, 250);\n        }, 3000);\n      }, 250);\n    }\n\n    function _error(message, clearUsername, clearUserpassword, callback) {\n      _modal(message, 'error', clearUsername, clearUserpassword, callback);\n    }\n\n    function _success(message, callback) {\n      _modal(message, 'success', true, true, callback);\n    }\n\n    function _submit() {\n      if (Login.get('inForgotPassword')) {\n        Login.fire('forgotPassword', {\n          password: Login.get('username'),\n          confirmPassword: Login.get('userpassword')\n        });\n      }\n      else if (Login.get('inForgotCode')) {\n        Login.fire('forgotCode', {\n          code: Login.get('username')\n        });\n      }\n      else if (Login.get('inForgot')) {\n        Login.fire('forgot', {\n          username: Login.get('username')\n        });\n      }\n      else {\n        Login.fire('login', {\n          username: Login.get('username'),\n          userpassword: Login.get('userpassword')\n        });\n      }\n    }\n\n    _$el.login.find('.pl-login-form-content .input').keypress(function(event) {\n      // enter\n      if (event.which == 13) {\n        _submit();\n\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    });\n\n    var lastObserveUsernameDate = new Date();\n\n    Login.observe('username', function() {\n      if (Login.get('inForgotCode') || Login.get('inForgotPassword')) {\n        return;\n      }\n\n      lastObserveUsernameDate = new Date();\n\n      var username = Login.get('username');\n\n      setTimeout(function() {\n        if (new Date().getTime() - lastObserveUsernameDate.getTime() >= 1000) {\n          Login.fire('username', {\n            username: username\n          });\n        }\n      }, 1000);\n    });\n\n    Login.observe('avatar', function(value, oldValue) {\n      if (oldValue == value) {\n        return;\n      }\n      if (!value) {\n        value = 'null';\n        Login.set('avatar', value);\n        if (oldValue == 'null') {\n          return;\n        }\n      }\n\n      Login.set('oldAvatar', oldValue);\n      setTimeout(function() {\n        Login.set('oldAvatar', null);\n      }, 650);\n    });\n\n    Login.on('teardown', function() {\n      Login = null;\n      _$el.window.off('resize', _resize);\n    });\n\n    function _close() {\n      Login.fire('closed');\n\n      if (Login && !Login.shouldDestroy) {\n        Login.teardown();\n      }\n    }\n\n    Login.on('logged', function(text) {\n      var ScreenMessage = Login.findChild('name', 'pl-screen-message');\n      ScreenMessage.fire('closeTitle');\n\n      Login.set('storyboard', 'sb-hide-1');\n\n      setTimeout(function() {\n        Login.set('storyboard', 'sb-hide-2');\n\n        setTimeout(function() {\n          Login.set('storyboard', 'sb-hide-3');\n\n          setTimeout(function() {\n\n            if (text) {\n              ScreenMessage.fire('play', {\n                message: text,\n                done: function() {\n                  _close();\n                }\n              });\n            }\n            else {\n              _close();\n            }\n          }, 150);\n        }, 400);\n      }, 350);\n    });\n\n    Login.on('close', _close);\n\n    Login.on('error', function(args) {\n      args = $.extend(true, {\n        message: 'You have an error in your credentials.',\n        clearUsername: false,\n        clearUserpassword: true\n      }, args || {});\n\n      _error(args.message, args.clearUsername, args.clearUserpassword, _focusName);\n    });\n\n    Login.on('displayForgot', function() {\n      _refresh();\n      Login.set('inForgot', true);\n      Login.fire('enterForgot');\n\n      setTimeout(_focusName);\n    });\n\n    Login.on('openHelp', function() {\n      Login.set('inHelp', true);\n      setTimeout(_focusName);\n    });\n\n    Login.on('displayLogin', function() {\n      var inForgot = Login.get('inForgot'),\n          inForgotCode = Login.get('inForgotCode'),\n          inForgotPassword = Login.get('inForgotPassword');\n\n      if (inForgotCode || inForgotPassword) {\n        Login.set('username', '');\n        Login.set('userpassword', '');\n      }\n\n      Login.set('inHelp', false);\n      Login.set('inForgot', false);\n      Login.set('inForgotCode', false);\n      Login.set('inForgotPassword', false);\n      Login.set('texts.usernamePlaceholder', Login.get('texts.username'));\n      Login.set('texts.userpasswordPlaceholder', Login.get('texts.userpassword'));\n\n      if (inForgotCode) {\n        Login.fire('exitForgotCode');\n      }\n\n      if (inForgotPassword) {\n        Login.fire('exitForgotPassword');\n      }\n\n      if (inForgot) {\n        Login.fire('exitForgot');\n      }\n\n      setTimeout(_focusName);\n    });\n\n    Login.on('forgotSuccess', function() {\n      Login.set('inForgotCode', true);\n      Login.set('username', '');\n      Login.set('texts.usernamePlaceholder', Login.get('texts.code'));\n\n      Login.fire('enterForgotCode');\n\n      setTimeout(_focusName);\n    });\n\n    Login.on('forgotError', function(args) {\n      args = $.extend(true, {\n        message: 'This email address doesn\\'t exist.',\n        clearUsername: false,\n        clearUserpassword: false\n      }, args || {});\n\n      _error(args.message, args.clearUsername, args.clearUserpassword, _focusName);\n    });\n\n    Login.on('forgotCodeSuccess', function() {\n      Login.set('inForgotCode', false);\n      Login.set('inForgotPassword', true);\n      Login.set('username', '');\n      Login.set('texts.usernamePlaceholder', Login.get('texts.userpassword'));\n      Login.set('userpassword', '');\n      Login.set('texts.userpasswordPlaceholder', Login.get('texts.userpasswordconfirm'));\n\n      Login.fire('enterForgotPassword');\n\n      setTimeout(_focusName);\n    });\n\n    Login.on('forgotCodeError', function(args) {\n      args = $.extend(true, {\n        message: 'Code invalid.',\n        clearUsername: true,\n        clearUserpassword: false\n      }, args || {});\n\n      _error(args.message, args.clearUsername, args.clearUserpassword, _focusName);\n    });\n\n    Login.on('forgotPasswordSuccess', function(args) {\n      args = $.extend(true, {\n        message: 'New password registered.'\n      }, args || {});\n\n      _success(args.message, function() {\n        Login.fire('displayLogin');\n      });\n    });\n\n    Login.on('forgotPasswordError', function(args) {\n      args = $.extend(true, {\n        message: 'Passwords are invalid.',\n        clearUsername: true,\n        clearUserpassword: true\n      }, args || {});\n\n      _error(args.message, args.clearUsername, args.clearUserpassword, _focusName);\n    });\n\n    function _resize() {\n      if (!Login) {\n        return;\n      }\n\n      var storyboard = Login.get('storyboard');\n\n      if (storyboard == 'sb-show-2' || storyboard == 'sb-show-3' || storyboard == 'sb-show-4') {\n        _refresh();\n      }\n    }\n\n    _$el.window.resize(_resize);\n\n    Login.require().then(function() {\n      var ScreenMessage = Login.findChild('name', 'pl-screen-message'),\n          textQuestion = Login.get('texts.question');\n\n      textQuestion = !textQuestion && textQuestion !== '' ? 'Who are you?' : textQuestion;\n\n      ScreenMessage.fire('play', {\n        message: textQuestion,\n        lastLineToTitle: true,\n        displayTextTime: 350,\n        done: function() {\n          _$el.message = $(ScreenMessage.el).find('.pl-screen-messages-message');\n\n          var messageHeight = _$el.message.outerHeight(true);\n\n          Login.set('top', _$el.message.offset().top + messageHeight - 1);\n          Login.set('height', 1);\n          Login.set('storyboard', 'sb-show-1');\n\n          setTimeout(function() {\n            Login.set('storyboard', 'sb-show-2');\n            Login.set('top', 40 + messageHeight);\n            _refresh();\n\n            setTimeout(function() {\n              Login.set('storyboard', 'sb-show-3');\n\n              setTimeout(function() {\n                _$el.login.find(!data.username ? '.name' : '.password').focus();\n                Login.set('storyboard', 'sb-show-4');\n              }, 450);\n\n            }, 450);\n          }, 650);\n        }\n      });\n\n      done();\n    });\n\n  });\n\n})();\n"],"sourceRoot":"/source/"}