!function(){"use strict";window.Ractive.controller("pl-login",function(e,s,o,t,r){function n(){var e=m.message.outerHeight(!0);c.set("height",m.window.height()-(40+e+30)),c.set("helpTop",m.forgotTexts.position().top)}function a(){m.login.find(".name").focus()}function i(e,o,t,r,n){c.set("inModal",!0),c.set("message",e),c.set("messageType",o),c.set("storyboardMessage","sb-message-1"),setTimeout(function(){t&&c.set("username",""),r&&c.set("userpassword",""),"success"==o&&(c.set("usernamePlaceholder",s.texts.username),c.set("userpasswordPlaceholder",s.texts.userpassword)),c.set("storyboardMessage","sb-message-2"),setTimeout(function(){c.set("storyboardMessage","sb-message-3"),setTimeout(function(){c.set("storyboardMessage","sb-message-4"),setTimeout(function(){c.set("storyboardError",null),c.set("inModal",!1),n&&n()},350)},250)},3e3)},250)}function d(e,s,o,t){i(e,"error",s,o,t)}function u(e,s){i(e,"success",!0,!0,s)}function f(){c.get("inForgotPassword")?c.fire("forgotPassword",{password:c.get("username"),confirmPassword:c.get("userpassword")}):c.get("inForgotCode")?c.fire("forgotCode",{code:c.get("username")}):c.get("inForgot")?c.fire("forgot",{username:c.get("username")}):c.fire("login",{username:c.get("username"),userpassword:c.get("userpassword")})}function g(){c.fire("closed"),c&&!c.shouldDestroy&&c.teardown()}function l(){if(c){var e=c.get("storyboard");("sb-show-2"==e||"sb-show-3"==e||"sb-show-4"==e)&&n()}}s.useforgot="undefined"==typeof s.useforgot?!0:s.useforgot,s.useforgot="true"==s.useforgot?!0:s.useforgot,s.useforgot="false"==s.useforgot?!1:s.useforgot,s.texts={},$.each(s,function(e,o){"text-"==e.substr(0,5)&&(e=e.substr(5,e.length-5),s.texts[e]=o)}),s.avatar=s.avatar?s.avatar:"null",s.inForgot=!1,s.texts.username="undefined"==typeof s.texts.username?"Name":s.texts.username,s.usernamePlaceholder=s.texts.username,s.texts.code="undefined"==typeof s.texts.code?"Code":s.texts.code,s.texts.userpassword="undefined"==typeof s.texts.userpassword?"Password":s.texts.userpassword,s.userpasswordPlaceholder=s.texts.userpassword,s.texts.userpasswordconfirm="undefined"==typeof s.texts.userpasswordconfirm?"Confirm password":s.texts.userpasswordconfirm,s.texts.forgotlink="undefined"==typeof s.texts.forgotlink?"I forgot my password":s.texts.forgotlink,s.texts.login="undefined"==typeof s.texts.login?"Back to login":s.texts.login,s.texts.forgottext="undefined"==typeof s.texts.forgottext?'Submit your email and press <span class="key">ENTER</span> to receive a validation code in your mailbox.':s.texts.forgottext,s.texts.forgotcodetext="undefined"==typeof s.texts.forgotcodetext?'Use your <strong>validation code</strong> and press <span class="key">ENTER</span> to get the possibility to change your password.':s.texts.forgotcodetext,s.texts.forgotpasswordtext="undefined"==typeof s.texts.forgotpasswordtext?'Enter your new password twice (to confirm) and press <span class="key">ENTER</span> to change your password.':s.texts.forgotpasswordtext,s.texts.forgotpasswordhelp="undefined"==typeof s.texts.forgotpasswordhelp?"When creating your password, remember the following:<ol><li>It must not contain your name.</li><li>It must contain one or more digits.</li><li>It is recommended to mix lowercase and uppercase characters.</li><li>It should be long over 7 characters.</li></ol>":s.texts.forgotpasswordhelp;var c=e({plName:"pl-login",data:$.extend(!0,{show:!1,top:0},s)}),m={window:$(window),login:$(c.el),forgotTexts:$(c.el).find(".pl-login-forgot-texts")};m.login.find(".pl-login-form-content .input").keypress(function(e){13==e.which&&(f(),e.preventDefault(),e.stopPropagation())});var p=new Date;c.observe("username",function(){if(!c.get("inForgotCode")&&!c.get("inForgotPassword")){p=new Date;var e=c.get("username");setTimeout(function(){(new Date).getTime()-p.getTime()>=1e3&&c.fire("username",{username:e})},1e3)}}),c.observe("avatar",function(e,s){s!=e&&(e||(e="null",c.set("avatar",e),"null"!=s))&&(c.set("oldAvatar",s),setTimeout(function(){c.set("oldAvatar",null)},650))}),c.on("teardown",function(){c=null,m.window.off("resize",l)}),c.on("logged",function(e){var s=c.findChild("name","pl-screen-message");s.fire("closeTitle"),c.set("storyboard","sb-hide-1"),setTimeout(function(){c.set("storyboard","sb-hide-2"),setTimeout(function(){c.set("storyboard","sb-hide-3"),setTimeout(function(){e?s.fire("play",{message:e,done:function(){g()}}):g()},150)},400)},350)}),c.on("close",g),c.on("error",function(e){e=$.extend(!0,{message:"You have an error in your credentials.",clearUsername:!1,clearUserpassword:!0},e||{}),d(e.message,e.clearUsername,e.clearUserpassword,a)}),c.on("displayForgot",function(){n(),c.set("inForgot",!0),c.fire("enterForgot"),setTimeout(a)}),c.on("openHelp",function(){c.set("inHelp",!0),setTimeout(a)}),c.on("displayLogin",function(){var e=c.get("inForgot"),o=c.get("inForgotCode"),t=c.get("inForgotPassword");(o||t)&&(c.set("username",""),c.set("userpassword","")),c.set("inHelp",!1),c.set("inForgot",!1),c.set("inForgotCode",!1),c.set("inForgotPassword",!1),c.set("usernamePlaceholder",s.texts.username),c.set("userpasswordPlaceholder",s.texts.userpassword),o&&c.fire("exitForgotCode"),t&&c.fire("exitForgotPassword"),e&&c.fire("exitForgot"),setTimeout(a)}),c.on("forgotSuccess",function(){c.set("inForgotCode",!0),c.set("username",""),c.set("usernamePlaceholder",s.texts.code),c.fire("enterForgotCode"),setTimeout(a)}),c.on("forgotError",function(e){e=$.extend(!0,{message:"This email address doesn't exist.",clearUsername:!1,clearUserpassword:!1},e||{}),d(e.message,e.clearUsername,e.clearUserpassword,a)}),c.on("forgotCodeSuccess",function(){c.set("inForgotCode",!1),c.set("inForgotPassword",!0),c.set("username",""),c.set("usernamePlaceholder",s.texts.userpassword),c.set("userpassword",""),c.set("userpasswordPlaceholder",s.texts.userpasswordconfirm),c.fire("enterForgotPassword"),setTimeout(a)}),c.on("forgotCodeError",function(e){e=$.extend(!0,{message:"Code invalid.",clearUsername:!0,clearUserpassword:!1},e||{}),d(e.message,e.clearUsername,e.clearUserpassword,a)}),c.on("forgotPasswordSuccess",function(e){e=$.extend(!0,{message:"New password registered."},e||{}),u(e.message,function(){c.fire("displayLogin")})}),c.on("forgotPasswordError",function(e){e=$.extend(!0,{message:"Passwords are invalid.",clearUsername:!0,clearUserpassword:!0},e||{}),d(e.message,e.clearUsername,e.clearUserpassword,a)}),m.window.resize(l),c.require().then(function(){var e=c.findChild("name","pl-screen-message"),o=c.get("texts.question");o=o||""===o?o:"Who are you?",e.fire("play",{message:o,lastLineToTitle:!0,displayTextTime:350,done:function(){m.message=$(e.el).find(".pl-screen-messages-message");var o=m.message.outerHeight(!0);c.set("top",m.message.offset().top+o-1),c.set("height",1),c.set("storyboard","sb-show-1"),setTimeout(function(){c.set("storyboard","sb-show-2"),c.set("top",40+o),n(),setTimeout(function(){c.set("storyboard","sb-show-3"),setTimeout(function(){m.login.find(s.username?".password":".name").focus(),c.set("storyboard","sb-show-4")},450)},450)},650)}}),r()})})}();
//# sourceMappingURL=pl-login.min.js.map
