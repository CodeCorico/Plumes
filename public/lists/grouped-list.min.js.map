{"version":3,"sources":["lists/grouped-list.js"],"names":["window","Ractive","controller","component","data","el","config","done","_refresh","GroupedList","fire","lvl","level","keypath","split","length","_$el","$","list","find","content","on","scrollTop","get","$lastItemMoved","children","each","$item","this","removeClass","css","top","position","$prev","prevAll","Math","max","outerHeight","height","$next","filter","nextTop","z-index","min","addClass","scroll","resize","off","observe"],"mappings":"CAAA,WACE,YAEAA,QAAOC,QAAQC,WAAW,eAAgB,SAASC,EAAWC,EAAMC,EAAIC,EAAQC,GAgB9E,QAASC,KACPC,EAAYC,KAAK,WAhBnBN,EAAKO,IAAM,EACXP,EAAKQ,MAAQ,SAASC,GACpB,MAAOA,GAAQC,MAAM,SAASC,OAAS,EAGzC,IAAIN,GAAcN,GAChBC,KAAMA,IAGJY,GACEhB,OAAQiB,EAAEjB,QACVkB,KAAMD,EAAER,EAAYJ,IAAIc,KAAK,iBAC7BC,QAASH,EAAER,EAAYJ,IAAIc,KAAK,yBAOtCV,GAAYY,GAAG,UAAW,WACxB,GAAIC,GAAYN,EAAKE,KAAKK,IAAI,GAAGD,UAC7BE,EAAiB,IAErBR,GAAKI,QAAQK,WAAWC,KAAK,WAC3B,GAAIC,GAAQV,EAAEW,MACVhB,EAAQe,EAAMvB,KAAK,QAEvBuB,GACGE,YAAY,8CACZC,IAAI,MAAO,GAEd,IAAIC,GAAMJ,EAAMK,WAAWD,GAE3B,IAAc,IAAVnB,EAAa,CACf,GAAIqB,GAAQhB,EAAEU,EAAMO,QAAQ,WAAatB,EAAQ,IAAIW,IAAI,GACzDD,GAAYa,KAAKC,IAAIL,EAAKE,EAAMD,WAAWD,IAAME,EAAMI,aAAY,IAGrE,GAAUf,EAANS,EAAiB,CACnB,GAAIO,GAASX,EAAMU,aAAY,GAC3BE,EAAQZ,EAAMR,KAAK,wBAAwBqB,OAAO,WAChD,MAAOvB,GAAEW,MAAMxB,KAAK,UAAYQ,GAEtC2B,GAAQA,EAAMxB,OAASE,EAAEsB,EAAMhB,IAAI,IAAM,IACzC,IAAIkB,GAAUF,EAAQA,EAAMP,WAAWD,IAAMO,EAAStB,EAAKE,KAAKmB,cAAgBC,CAEhFX,GAAMG,KACJY,UAAW,KAAO9B,EAClBmB,IAAKI,KAAKQ,IAAIrB,EAAWmB,GAAWV,IAGlCU,EAAUnB,IACZK,EAAMiB,SAAS,sBACfpB,EAAiBG,MAKnBH,GACFA,EAAeoB,SAAS,6BAI5B5B,EAAKE,KAAK2B,OAAOrC,GAEjBQ,EAAKhB,OAAO8C,OAAOtC,GAEnBC,EAAYY,GAAG,WAAY,WACzBL,EAAKhB,OAAO+C,IAAI,SAAUvC,KAG5BC,EAAYuC,QAAQ,QAASxC,GAE7BA,IAEAD","file":"lists/grouped-list.min.js","sourcesContent":["(function() {\r\n  'use strict';\r\n\r\n  window.Ractive.controller('grouped-list', function(component, data, el, config, done) {\r\n    data.lvl = 0;\r\n    data.level = function(keypath) {\r\n      return keypath.split('items').length - 2;\r\n    };\r\n\r\n    var GroupedList = component({\r\n      data: data\r\n    });\r\n\r\n    var _$el = {\r\n          window: $(window),\r\n          list: $(GroupedList.el).find('.grouped-list'),\r\n          content: $(GroupedList.el).find('.grouped-list-content')\r\n        };\r\n\r\n    function _refresh() {\r\n      GroupedList.fire('refresh');\r\n    }\r\n\r\n    GroupedList.on('refresh', function() {\r\n      var scrollTop = _$el.list.get(0).scrollTop,\r\n          $lastItemMoved = null;\r\n\r\n      _$el.content.children().each(function() {\r\n        var $item = $(this),\r\n            level = $item.data('level');\r\n\r\n        $item\r\n          .removeClass('grouped-list-fixed grouped-list-fixed-last')\r\n          .css('top', '');\r\n\r\n        var top = $item.position().top;\r\n\r\n        if (level !== 0) {\r\n          var $prev = $($item.prevAll('.level-' + (level - 1)).get(0));\r\n          scrollTop = Math.max(top, $prev.position().top + $prev.outerHeight(true));\r\n        }\r\n\r\n        if (top < scrollTop) {\r\n          var height = $item.outerHeight(true),\r\n              $next = $item.find('~ .grouped-list-item').filter(function() {\r\n                return $(this).data('level') <= level;\r\n              });\r\n          $next = $next.length ? $($next.get(0)) : null;\r\n          var nextTop = $next ? $next.position().top - height : _$el.list.outerHeight() - height;\r\n\r\n          $item.css({\r\n            'z-index': 9999 - level,\r\n            top: Math.min(scrollTop, nextTop) - top\r\n          });\r\n\r\n          if (nextTop > scrollTop) {\r\n            $item.addClass('grouped-list-fixed');\r\n            $lastItemMoved = $item;\r\n          }\r\n        }\r\n      });\r\n\r\n      if ($lastItemMoved) {\r\n        $lastItemMoved.addClass('grouped-list-fixed-last');\r\n      }\r\n    });\r\n\r\n    _$el.list.scroll(_refresh);\r\n\r\n    _$el.window.resize(_refresh);\r\n\r\n    GroupedList.on('teardown', function() {\r\n      _$el.window.off('resize', _refresh);\r\n    });\r\n\r\n    GroupedList.observe('items', _refresh);\r\n\r\n    _refresh();\r\n\r\n    done();\r\n  });\r\n\r\n})();\r\n"],"sourceRoot":"/source/"}