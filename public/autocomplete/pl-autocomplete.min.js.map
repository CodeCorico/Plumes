{"version":3,"sources":["autocomplete/pl-autocomplete.js"],"names":["window","Ractive","controller","component","data","el","config","done","_refresh","top","_$el","input","offset","width","outerWidth","height","outerHeight","Autocomplete","set","get","length","listContent","_select","event","select","val","blur","_change","change","plName","$","extend","focused","inEdition","listfocused","listTop","listWidth","listHeight","selection","partials","templateDefault","join","refresh","clear","focus","find","list","template","on","parseInt","keypath","substring","lastIndexOf","original","stopPropagation","preventDefault","context","value","keydown","keyup","charCode","keyCode","observe","setTimeout"],"mappings":"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","file":"autocomplete/pl-autocomplete.min.js","sourcesContent":["(function() {\n  'use strict';\n\n  window.Ractive.controller('pl-autocomplete', function(component, data, el, config, done) {\n\n    var Autocomplete = component({\n          plName: 'pl-autocomplete',\n          data: $.extend(true, {\n            focused: false,\n            inEdition: false,\n            listfocused: -1,\n            listTop: 0,\n            listWidth: 0,\n            listHeight: 0,\n            selection: ''\n          }, data),\n          partials: $.extend(true, {\n            templateDefault: [\n            '<div',\n              ' class=\"pl-autocomplete-list-item {{listfocused == @index ? \\'focused\\' : \\'\\'}}\"',\n              ' on-mousedown=\"selectListItem\"',\n              ' on-mouseenter=\"enterListItem\"',\n            '>',\n              '{{{display}}}',\n            '</div>'\n            ].join('')\n          }, config.partials),\n\n          refresh: function() {\n            _refresh();\n          },\n\n          clear: function() {\n            _$el.input.val('');\n\n            _change(event);\n          },\n\n          focus: function() {\n            _$el.input.focus();\n          }\n        }),\n        _$el = {\n          window: $(window),\n          input: $(Autocomplete.el).find('.pl-autocomplete-input'),\n          selection: $(Autocomplete.el).find('.pl-autocomplete-selection'),\n          list: $(Autocomplete.el).find('.pl-autocomplete-list'),\n          listContent: $(Autocomplete.el).find('.pl-autocomplete-list-content')\n        };\n\n    function _refresh() {\n      var top = _$el.input.offset().top,\n          width = _$el.input.outerWidth(),\n          height = _$el.input.outerHeight();\n\n      Autocomplete.set('inEdition', Autocomplete.get('focused') && Autocomplete.get('list') && Autocomplete.get('list').length);\n\n      Autocomplete.set('listWidth', width);\n      Autocomplete.set('listHeight', Autocomplete.get('focused') ? _$el.listContent.outerHeight() : 0);\n\n      if (top + (height - 2) + Autocomplete.get('listHeight') > _$el.window.height()) {\n        Autocomplete.set('listFromBottom', true);\n        Autocomplete.set('listTop', -Autocomplete.get('listHeight') + 2);\n      }\n      else {\n        Autocomplete.set('listFromBottom', false);\n        Autocomplete.set('listTop', height - 2);\n      }\n\n      Autocomplete.set('selectionWidth', width);\n    }\n\n    function _select(event) {\n      var select = Autocomplete.get('select');\n      if (select) {\n        select(event, _$el.input.val(), Autocomplete);\n      }\n\n      _$el.input.blur();\n    }\n\n    function _change(event) {\n      var change = Autocomplete.get('change');\n      if (change) {\n        change(event, _$el.input.val(), Autocomplete);\n      }\n    }\n\n    Autocomplete.partials.template = Autocomplete.partials.template || Autocomplete.partials.templateDefault;\n\n    Autocomplete.on('enterListItem', function(event) {\n      Autocomplete.set('listfocused', parseInt(event.keypath.substring(event.keypath.lastIndexOf('.') + 1), 10));\n    });\n\n    Autocomplete.on('selectListItem', function(event) {\n      event.original.stopPropagation();\n      event.original.preventDefault();\n\n      _$el.input.val(event.context.value);\n\n      _change(event);\n    });\n\n    Autocomplete.on('inputFocus', function(event) {\n      Autocomplete.set('focused', true);\n\n      _refresh();\n\n      var focus = Autocomplete.get('focus');\n      if (focus) {\n        focus(event, _$el.input.val(), Autocomplete);\n      }\n    });\n\n    Autocomplete.on('inputBlur', function(event) {\n      Autocomplete.set('focused', false);\n\n      _refresh();\n\n      var blur = Autocomplete.get('blur');\n      if (blur) {\n        blur(event, _$el.input.val(), Autocomplete);\n      }\n    });\n\n    Autocomplete.on('inputKeydown', function(event) {\n      var keydown = Autocomplete.get('keydown');\n      if (keydown) {\n        keydown(event, Autocomplete);\n      }\n    });\n\n    Autocomplete.on('inputKeyup', function(event) {\n      var keyup = Autocomplete.get('keyup');\n      if (keyup) {\n        if (keyup(event, Autocomplete) === false) {\n          return;\n        }\n      }\n\n      var charCode = event.original.charCode ? event.original.charCode : event.original.keyCode,\n          selection = Autocomplete.get('selection'),\n          list = Autocomplete.get('list'),\n          listfocused = Autocomplete.get('listfocused');\n\n      // Right\n      if (charCode == 39 && selection) {\n        _$el.input.val(selection);\n\n        _change(event);\n\n        return;\n      }\n\n      // Top - Bottom\n      if ((charCode == 38 || charCode == 40) && list && list.length) {\n        listfocused = listfocused + (charCode == 38 ? -1 : 1);\n        listfocused = listfocused == -2 ? list.length - 1 : listfocused;\n        listfocused = listfocused == list.length ? -1 : listfocused;\n\n        Autocomplete.set('listfocused', listfocused);\n\n        return;\n      }\n\n      // Enter\n      if (charCode == 13) {\n        if (!list || !list.length || listfocused === -1) {\n          _select(event);\n        }\n        else if (list && list.length && list[listfocused]) {\n          _$el.input.val(list[listfocused].value);\n\n          Autocomplete.set('listfocused', -1);\n\n          _change(event);\n        }\n\n        return;\n      }\n\n      _change(event);\n    });\n\n    Autocomplete.observe('list', function(list) {\n      Autocomplete.set('selection', list && list.length && list[0].value || '');\n      Autocomplete.set('listfocused', -1);\n\n      setTimeout(_refresh);\n    });\n\n    done();\n  });\n\n})();\n"],"sourceRoot":"/source/"}