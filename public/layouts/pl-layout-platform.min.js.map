{"version":3,"sources":["layouts/pl-layout-platform.js"],"names":["window","Ractive","controller","component","data","el","config","done","_resize","openOrientation","screenWidth","_$el","width","VIEWS","DESKTOP","LayoutPlatform","set","get","_contexts","right","close","left","TABLET","MOBILE","templateWidth","contentTemplate","outerWidth","fire","_closeContext","orientation","panel","findChild","_registerGroupedButtonsEvents","on","_beforeButtonsAction","_registerContextEvents","_displayContextGroup","context","$context","$group","find","removeClass","addClass","title","attr","open","args","button","group","beforeGroup","callback","forEach","$","length","hasClass","isOpened","closeContent","beforeContext","_updatePosition","titleText","_updateTitleArea","height","titleWidth","Title","plName","extend","loaded","titleLeftOffset","titleBgLeftOffset","titleBgWidth","titleBgHeight","buttonsleft","buttonsright","contextlefttitle","contextrighttitle","contextleftusetitle","contextrightusetitle","contextleftscrollbar","contextrightscrollbar","leftContextWidth","rightContextWidth","leftContextOpened","rightContextOpened","contentLeft","contentRight","contentMedia","crossleftcontext","crossrightcontext","Page","parentRequire","platform","content","bindUses","resize","off","setTimeout","selectApp","name","fireFunc","addApp","app","indexOrPosition","addTitle","removeApp","removeTitle","onloaded","beforeRequire","beforerequire","l","require","then","cls","filter","value","indexOf","push","toLowerCase","replace","fireSelected","remove"],"mappings":"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","file":"layouts/pl-layout-platform.min.js","sourcesContent":["(function() {\n  'use strict';\n\n  window.Ractive.controller('pl-layout-platform', function(component, data, el, config, done) {\n    var VIEWS = {\n          DESKTOP: 1000,\n          TABLET: 450,\n          MOBILE: 0\n        },\n\n        Title = null,\n        _contexts = {\n          left: null,\n          right: null\n        };\n\n    function _resize(openOrientation) {\n      var screenWidth = _$el.window.width();\n\n      if (screenWidth >= VIEWS.DESKTOP) {\n        LayoutPlatform.set('leftContextWidth', LayoutPlatform.get('leftContextOpened') ? '25%' : 0);\n        LayoutPlatform.set('rightContextWidth', LayoutPlatform.get('rightContextOpened') ? '25%' : 0);\n\n        LayoutPlatform.set('contentLeft', LayoutPlatform.get('leftContextOpened') ? '25%' : 0);\n        LayoutPlatform.set('contentRight', LayoutPlatform.get('rightContextOpened') ? '25%' : 0);\n\n        LayoutPlatform.set('screen', 'screen-desktop');\n      }\n      else {\n        if (openOrientation == 'left' && LayoutPlatform.get('rightContextOpened')) {\n          _contexts.right.close();\n          LayoutPlatform.set('rightContextOpened', false);\n        }\n        else if (openOrientation == 'right' && LayoutPlatform.get('leftContextOpened')) {\n          _contexts.left.close();\n          LayoutPlatform.set('leftContextOpened', false);\n        }\n        else if (LayoutPlatform.get('leftContextOpened') && LayoutPlatform.get('rightContextOpened')) {\n          _contexts.right.close();\n          LayoutPlatform.set('rightContextOpened', false);\n        }\n\n        if (screenWidth >= VIEWS.TABLET) {\n          LayoutPlatform.set('leftContextWidth', LayoutPlatform.get('leftContextOpened') ? '75%' : 0);\n          LayoutPlatform.set('rightContextWidth', LayoutPlatform.get('rightContextOpened') ? '75%' : 0);\n\n          LayoutPlatform.set('contentLeft',\n            LayoutPlatform.get('leftContextOpened') ? '75%' : (\n            LayoutPlatform.get('rightContextOpened') ? '-75%' : 0)\n          );\n          LayoutPlatform.set('contentRight',\n            LayoutPlatform.get('rightContextOpened') ? '75%' : (\n            LayoutPlatform.get('leftContextOpened') ? '-75%' : 0)\n          );\n\n          LayoutPlatform.set('screen', 'screen-tablet');\n        }\n        else if (screenWidth >= VIEWS.MOBILE) {\n          LayoutPlatform.set('leftContextWidth', LayoutPlatform.get('leftContextOpened') ? '100%' : 0);\n          LayoutPlatform.set('rightContextWidth', LayoutPlatform.get('rightContextOpened') ? '100%' : 0);\n\n          LayoutPlatform.set('contentLeft', 0);\n          LayoutPlatform.set('contentRight', 0);\n\n          LayoutPlatform.set('screen', 'screen-mobile');\n        }\n      }\n\n      var templateWidth = _$el.contentTemplate.outerWidth();\n\n      if (templateWidth >= VIEWS.DESKTOP) {\n        LayoutPlatform.set('contentMedia', 'media-desktop');\n\n        LayoutPlatform.fire('view', 'DESKTOP');\n      }\n      else if (templateWidth >= VIEWS.TABLET) {\n        LayoutPlatform.set('contentMedia', 'media-tablet');\n\n        LayoutPlatform.fire('view', 'TABLET');\n      }\n      else if (templateWidth >= VIEWS.MOBILE) {\n        LayoutPlatform.set('contentMedia', 'media-mobile');\n\n        LayoutPlatform.fire('view', 'MOBILE');\n      }\n    }\n\n    function _closeContext(orientation) {\n      var panel = LayoutPlatform.findChild('data-pl-name', 'context-' + orientation);\n\n      panel.close();\n    }\n\n    function _registerGroupedButtonsEvents(orientation, component) {\n      component.on('beforeAction', _beforeButtonsAction);\n    }\n\n    function _registerContextEvents(orientation, component) {\n      _contexts[orientation] = component;\n\n      component.on('beforeOpen', function() {\n        LayoutPlatform.set(orientation + 'ContextOpened', true);\n\n        _resize(orientation);\n      });\n\n      component.on('close', function() {\n        LayoutPlatform.set(orientation + 'ContextOpened', false);\n\n        _resize();\n      });\n    }\n\n    function _displayContextGroup(orientation, context, $context, $group) {\n      $context.find('.pl-group').removeClass('opened');\n\n      $group.addClass('opened');\n\n      var title = $group.attr('data-title');\n      if (typeof title != 'undefined') {\n        LayoutPlatform.set('context' + orientation + 'title', title);\n      }\n\n      context.open();\n    }\n\n    function _beforeButtonsAction(args) {\n      if (!args || !args.button || (!args.button.context && !args.button.group)) {\n        return;\n      }\n\n      if (args.button.group) {\n        var beforeGroup = args.button.beforeGroup || function(context, $group, callback) {\n          callback();\n        };\n\n        ['left', 'right'].forEach(function(orientation) {\n          var context = _contexts[orientation],\n              $context = $(context.el),\n              $group = $context.find('[data-group=\"' + args.button.group + '\"]');\n\n          if (!$group.length) {\n            return;\n          }\n\n          if ($group.hasClass('opened')) {\n            return context.open();\n          }\n\n          beforeGroup(context, $group, function() {\n            if (context.isOpened()) {\n              context.closeContent(function() {\n                _displayContextGroup(orientation, context, $context, $group);\n              });\n            }\n            else {\n              _displayContextGroup(orientation, context, $context, $group);\n            }\n          });\n        });\n      }\n      else if (args.button.context) {\n        var context = _contexts[args.button.context];\n        if (!context) {\n          return;\n        }\n\n        var beforeContext = args.button.beforeContext || function(callback) {\n          callback();\n        };\n\n        beforeContext(context, function callback() {\n          context.open();\n        });\n      }\n    }\n\n    var LayoutPlatform = component({\n          plName: 'pl-layout-platform',\n          data: $.extend(true, {\n            loaded: false,\n            titleLeftOffset: -80,\n            titleBgLeftOffset: 0,\n            titleBgWidth: 0,\n            titleBgHeight: 0,\n            buttonsleft: [],\n            buttonsright: [],\n            contextlefttitle: '',\n            contextrighttitle: '',\n            contextleftusetitle: true,\n            contextrightusetitle: true,\n            contextleftscrollbar: true,\n            contextrightscrollbar: true,\n            leftContextWidth: 0,\n            rightContextWidth: 0,\n            leftContextOpened: false,\n            rightContextOpened: false,\n            contentLeft: 0,\n            contentRight: 0,\n            contentMedia: '',\n\n            crossleftcontext: function() {\n              _closeContext('left');\n            },\n            crossrightcontext: function() {\n              _closeContext('right');\n            }\n          }, data)\n        }),\n        Page = LayoutPlatform.parentRequire,\n        _$el = {\n          window: $(window),\n          platform: $(LayoutPlatform.el),\n          content: $(LayoutPlatform.el).find('.pl-layout-platform-content'),\n          contentTemplate: $(LayoutPlatform.el).find('.pl-layout-platform-content-template')\n        };\n\n    window.Ractive.bindUses(LayoutPlatform, ['mask']);\n\n    _$el.window.resize(_resize);\n\n    LayoutPlatform.on('teardown', function() {\n      _$el.window.off('resize', _resize);\n    });\n\n    _resize();\n\n    function _updatePosition() {\n      LayoutPlatform.set('titleLeftOffset', _$el.titleText.outerWidth() / 2);\n    }\n\n    function _updateTitleArea(height, open) {\n      LayoutPlatform.set('titleOpened', open);\n\n      if (open) {\n        var titleWidth = _$el.title.outerWidth() + 40;\n        LayoutPlatform.set('titleBgLeftOffset', titleWidth / 2);\n        LayoutPlatform.set('titleBgWidth', titleWidth);\n        LayoutPlatform.set('titleBgHeight', height + 30);\n      }\n      else {\n        LayoutPlatform.set('titleBgLeftOffset', 0);\n        LayoutPlatform.set('titleBgWidth', 0);\n      }\n    }\n\n    LayoutPlatform.on('titleOpen', function(args) {\n      _updateTitleArea(args.height, true);\n    });\n\n    LayoutPlatform.on('titleClose', function(args) {\n      _updateTitleArea(args.height, false);\n\n      setTimeout(_updatePosition, 550);\n    });\n\n    LayoutPlatform.selectApp = function(name, fireFunc, callback) {\n      if (!Title) {\n        return;\n      }\n\n      Title.selectApp(name, fireFunc, callback);\n    };\n\n    LayoutPlatform.addApp = function(app, indexOrPosition) {\n      if (!Title) {\n        return;\n      }\n\n      Title.addTitle(app, indexOrPosition);\n    };\n\n    LayoutPlatform.removeApp = function(name) {\n      if (!Title) {\n        return;\n      }\n\n      Title.removeTitle(name);\n    };\n\n    setTimeout(function() {\n      if (data.onloaded) {\n        data.onloaded(LayoutPlatform);\n      }\n\n      LayoutPlatform.set('loaded', true);\n\n      var beforeRequire = data.beforerequire || function(l, callback) {\n        callback();\n      };\n\n      beforeRequire(LayoutPlatform, function() {\n        LayoutPlatform.set('beforerequire', null);\n        data.beforerequire = null;\n\n        LayoutPlatform.set('start', true);\n\n        LayoutPlatform.require().then(function() {\n          _registerGroupedButtonsEvents('left', LayoutPlatform.findChild('data-pl-name', 'buttons-left'));\n          _registerGroupedButtonsEvents('right', LayoutPlatform.findChild('data-pl-name', 'buttons-right'));\n\n          _registerContextEvents('left', LayoutPlatform.findChild('data-pl-name', 'context-left'));\n          _registerContextEvents('right', LayoutPlatform.findChild('data-pl-name', 'context-right'));\n\n          Title = LayoutPlatform.findChild('name', 'pl-dropdown-title');\n\n          _$el.title = _$el.platform.find('.pl-layout-title');\n          _$el.titleText = _$el.platform.find('.pl-layout-title h2 span');\n\n          _updatePosition();\n\n          if (Title) {\n            Title.on('open', function(args) {\n              LayoutPlatform.fire('titleOpen', args);\n            });\n\n            Title.on('close', function(args) {\n              LayoutPlatform.fire('titleClose', args);\n            });\n\n            Title.on('titleSelected', function(args) {\n              var cls = Page.get('cls') || [];\n              cls = cls.filter(function(value) {\n                return value.indexOf('app-') !== 0;\n              });\n\n              cls.push('app-' + args.title.name\n                .toLowerCase()\n                .replace(/[^a-z0-9]/gi, '')\n              );\n\n              Page.set('cls', cls);\n            });\n\n            Title.fireSelected();\n          }\n\n          done();\n\n          setTimeout(function() {\n            _$el.platform.find('.pl-layout-mask').remove();\n          });\n        });\n      });\n    });\n  });\n\n})();\n"],"sourceRoot":"/source/"}